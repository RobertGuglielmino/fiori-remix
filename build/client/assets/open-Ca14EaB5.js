import{r as u,j as a,d as b,i as C}from"./index-Ivv8m7sf.js";import{c as E}from"./centsToDollars-BemH1-NO.js";import{u as N,a as P,R as j}from"./FIORIContext-B_fc8As3.js";import{u as S}from"./components-YI_IdiTz.js";function y({src:e,alt:o,handleCardClick:l}){const[s,i]=u.useState({}),n=u.useRef(null),c=u.useRef(null),d=u.useRef(!1),h=15,g=u.useCallback(m=>{!d.current||!n.current||(c.current&&cancelAnimationFrame(c.current),c.current=requestAnimationFrame(()=>{if(n.current){const t=n.current.getBoundingClientRect(),r=m.clientX-t.left,p=m.clientY-t.top,v=t.width/2,k=t.height/2,w=(p-k)/k*-15,R=(r-v)/v*h;i({transform:`perspective(1000px) rotateX(${w}deg) rotateY(${R}deg) translateZ(20px) scale(1.02)`,boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"})}}))},[]),x=u.useCallback(()=>{d.current=!0,i({transform:"translateZ(20px) scale(1.02)",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"})},[]),f=u.useCallback(()=>{d.current=!1,c.current&&(cancelAnimationFrame(c.current),c.current=null),i({transform:"",boxShadow:""})},[]);return a.jsx("div",{className:"relative w-full h-full relative",children:a.jsx("div",{ref:n,className:"w-full h-full rounded-lg shadow-xl overflow-hidden transition-all duration-200 ease-out",style:{...s,transformStyle:"preserve-3d",willChange:"transform"},onMouseEnter:x,onMouseMove:g,onMouseLeave:f,children:a.jsx("img",{src:e,alt:o||"Interactive image",className:"w-full h-full object-cover ",loading:"lazy",onClick:()=>l()})})})}const I="/assets/mtg_back-xLlnET8g.png";function D({maskImage:e,maskPosition:o,src:l}){const s=["mask-image-[url(/images/masks/mask1.png)]","mask-image-[url(/images/masks/mask2.png)]","mask-image-[url(/images/masks/mask3.png)]","mask-image-[url(/images/masks/mask4.png)]","mask-image-[url(/images/masks/mask5.png)]"];return a.jsx("div",{className:"relative w-full h-full",children:a.jsx("img",{src:l,loading:"lazy",className:`w-full h-full object-cover relative overflow-hidden rounded-xl transition-all duration-500 scale-90 grayscale rotate-[3deg] rayscale ${s[e]} scale-[90%] mask-position-[50%_50%] mask-size-cover`})})}function M({src:e,alt:o,foil:l}){return a.jsxs("div",{className:"relative w-full h-full relative",children:[a.jsx("img",{src:e,alt:o||"Interactive image",className:"w-full h-full object-cover rounded-xl",loading:"lazy"}),l&&a.jsx("div",{className:"absolute inset-0 bg-foil-ray bg-400 animate-foil pointer-events-none rounded-lg"})]})}function O({name:e,cents:o,image:l,cf_image:s,status:i,foil:n,rotation:c,maskImage:d,handleCardClick:h}){const[g,x]=u.useState("25%_25%");u.useEffect(()=>{const t=new Image;t.src=s;const r=new Image;r.src=I},[s]);let f=i==="FLIPPED"||i==="RIPPED";const m="Â ";return a.jsxs("div",{className:"flex flex-col items-center rounded-lg",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`absolute top-0 left-0 w-full h-full transition-opacity duration-200 ${i==="NONE"?"opacity-100 z-10":"opacity-0 z-0"}`,children:a.jsx(y,{src:I,alt:"Card Back",handleCardClick:h})}),a.jsx("div",{className:`absolute top-0 left-0 w-full h-full transition-opacity duration-200 ${i==="FLIPPED"?"opacity-100 z-10":"opacity-0 z-0"}`,children:a.jsx(M,{src:s,alt:e,foil:n})}),a.jsx("div",{className:`absolute top-0 left-0 w-full h-full transition-opacity duration-100 ${i==="RIPPED"?"scale-80 opacity-100 z-10":"opacity-0 z-0"}`,children:a.jsx(D,{src:s,maskImage:d,maskPosition:g})}),a.jsx("div",{className:"invisible",children:a.jsx(y,{src:I,alt:"placeholder",handleCardClick:()=>{}})})]}),a.jsx("div",{className:"font-kanit text-center text-sm",children:f?e:m}),a.jsx("div",{className:"font-kanit text-center text-sm",children:f?E(o):m})]})}function A(){let e=localStorage.getItem("flipOrRipUserId");return e?console.log("Retrieved existing user ID:",e):(e=crypto.randomUUID(),localStorage.setItem("flipOrRipUserId",e),console.log("Created new user ID:",e)),e}async function L(e,o,l){await fetch("https://s8ib0k5c81.execute-api.us-east-1.amazonaws.com/prod/flip-or-rip-lambda/stats",{method:"POST",body:JSON.stringify({cardStatusList:e,userId:o,packId:l}),headers:{"Content-Type":"application/json"}}).then(async s=>{const i=await s.json();return console.log("Loader data received:",i),i})}function T(){const e=N(),o=P(),l=S().body,s=l.cards,i=l.packId,[n,c]=u.useState(z(s.length)),d=(t,r)=>{switch(r){case"FLIP":h(t);break;case"RIP":g(t);break}};return a.jsx("div",{className:"flex flex-wrap justify-center sm:px-4 sm:px-8 lg:px-4 2xl:px-0 py-4",children:s.map((t,r)=>a.jsx("div",{className:"grow-0 shrink basis-[30vw] sm:basis-[20vw]  lg:basis-[14vw] xl:basis-[12vw] p-2",children:a.jsx(O,{index:r,...t,status:n[r].status,foil:s[r].foil,rotation:n[r].rotation,maskImage:n[r].maskImage,handleCardClick:()=>d(r,o.action)},s[r].scryfallId)}))});function h(t){const r=s[t].cents;c(n.map(p=>p.id===t?{id:t,status:"FLIPPED",rotation:0,maskImage:-1}:p)),e({type:j.FLIP_CARD,payload:{amountSaved:r}}),x()}function g(t){const r=s[t].cents,p=n[t].rotation,v=n[t].maskImage;c(n.map(k=>k.id===t?{id:t,status:"RIPPED",rotation:p,maskImage:v}:k)),e({type:j.RIP_CARD,payload:{amountLost:r}}),x()}function x(){$(n)&&(console.log("All cards have been flipped or ripped"),f(),m(),L(n,A(),i))}function f(){e({type:j.PACK_STATE,payload:{action:"END"}})}function m(){e({type:j.PACK_COMPLETED,payload:{}})}}function z(e){const o=[];for(let l=0;l<e;l++)o.push({id:l,status:"NONE",rotation:F(),maskImage:U()});return o}function F(){return Math.floor(Math.random()*7)-3}function U(){return Math.floor(Math.random()*5)}function $(e){return e.filter(o=>o.status=="NONE").length==1}function H(){const e=b();return console.log("IN THE OPEN ROUTE ERROR"),C(e)?a.jsxs("div",{children:[a.jsxs("h1",{children:[e.status," ",e.statusText]}),a.jsx("p",{children:e.data})]}):e instanceof Error?a.jsxs("div",{children:[a.jsx("h1",{children:"Error"}),a.jsx("p",{children:e.message}),a.jsx("p",{children:"The stack trace is:"}),a.jsx("pre",{children:e.stack})]}):a.jsx("h1",{children:"Unknown Error"})}function K(){return a.jsx("div",{className:"",id:"index-page",children:a.jsx(T,{})})}export{H as ErrorBoundary,K as default};
