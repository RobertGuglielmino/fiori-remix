import{r as u,j as a,d as C,i as E}from"./index-CNcSpTgT.js";import{c as y}from"./centsToDollars-BemH1-NO.js";import{u as w,a as P,R as I}from"./FIORIContext-Cl75LApW.js";import{u as b}from"./components-BLxEVhed.js";function N({src:e,alt:r,handleCardClick:n}){const[o,c]=u.useState({}),s=u.useRef(null),i=u.useRef(null),d=u.useRef(!1),g=15,h=u.useCallback(m=>{!d.current||!s.current||(i.current&&cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{if(s.current){const t=s.current.getBoundingClientRect(),l=m.clientX-t.left,p=m.clientY-t.top,v=t.width/2,k=t.height/2,j=(p-k)/k*-15,R=(l-v)/v*g;c({transform:`perspective(1000px) rotateX(${j}deg) rotateY(${R}deg) translateZ(20px) scale(1.02)`,boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"})}}))},[]),x=u.useCallback(()=>{d.current=!0,c({transform:"translateZ(20px) scale(1.02)",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"})},[]),f=u.useCallback(()=>{d.current=!1,i.current&&(cancelAnimationFrame(i.current),i.current=null),c({transform:"",boxShadow:""})},[]);return a.jsx("div",{className:"relative w-full h-full relative",children:a.jsx("div",{ref:s,className:"w-full h-full rounded-lg shadow-xl overflow-hidden transition-all duration-200 ease-out",style:{...o,transformStyle:"preserve-3d",willChange:"transform"},onMouseEnter:x,onMouseMove:h,onMouseLeave:f,children:a.jsx("img",{src:e,alt:r||"Interactive image",className:"w-full h-full object-cover ",loading:"lazy",onClick:()=>n()})})})}const S="/assets/mtg_back-xLlnET8g.png";function D({maskImage:e,maskPosition:r,src:n}){const o=["mask-image-[url(/images/masks/mask1.png)]","mask-image-[url(/images/masks/mask2.png)]","mask-image-[url(/images/masks/mask3.png)]","mask-image-[url(/images/masks/mask4.png)]","mask-image-[url(/images/masks/mask5.png)]"];return a.jsx("div",{className:"relative w-full h-full",children:a.jsx("img",{src:n,className:`w-full h-full object-cover relative overflow-hidden rounded-xl transition-all duration-500 scale-90 grayscale rotate-[3deg] rayscale ${o[e]} scale-[90%] mask-position-[50%_50%] mask-size-cover`})})}function M({src:e,alt:r,foil:n}){return a.jsxs("div",{className:"relative w-full h-full relative",children:[a.jsx("img",{src:e,alt:r||"Interactive image",className:"w-full h-full object-cover rounded-xl",loading:"lazy"}),n&&a.jsx("div",{className:"absolute inset-0 bg-foil-ray bg-400 animate-foil pointer-events-none rounded-lg"})]})}function O({name:e,cents:r,image:n,cf_image:o,status:c,foil:s,rotation:i,maskImage:d,handleCardClick:g}){const[h,x]=u.useState("25%_25%");let f=c==="FLIPPED"||c==="RIPPED";const m="Â ";return a.jsxs("div",{className:"flex flex-col items-center rounded-lg",children:[c==="NONE"&&a.jsx(N,{src:S,alt:"test",handleCardClick:()=>g()}),c==="FLIPPED"&&a.jsx(M,{src:o,alt:"test",foil:s}),c==="RIPPED"&&a.jsx(D,{src:o,maskImage:d,maskPosition:h}),a.jsx("div",{className:"font-kanit text-center text-sm",children:f?e:m}),a.jsx("div",{className:"font-kanit text-center text-sm",children:f?y(r):m})]})}function A(){let e=localStorage.getItem("flipOrRipUserId");return e?console.log("Retrieved existing user ID:",e):(e=crypto.randomUUID(),localStorage.setItem("flipOrRipUserId",e),console.log("Created new user ID:",e)),e}async function L(e,r,n){await fetch("https://s8ib0k5c81.execute-api.us-east-1.amazonaws.com/prod/flip-or-rip-lambda/stats",{method:"POST",body:JSON.stringify({cardStatusList:e,userId:r,packId:n}),headers:{"Content-Type":"application/json"}}).then(async o=>{const c=await o.json();return console.log("Loader data received:",c),c})}function T(){const e=w(),r=P(),n=b().body,o=n.cards,c=n.packId,[s,i]=u.useState(F(o.length)),d=(t,l)=>{switch(l){case"FLIP":g(t);break;case"RIP":h(t);break}};return a.jsx("div",{className:"flex flex-wrap justify-center sm:px-4 sm:px-8 lg:px-16 py-4",children:o.map((t,l)=>a.jsx("div",{className:"grow-0 shrink sm:basis-[24vw] md:basis-[20vw] lg:basis-[12vw] p-2",children:a.jsx(O,{index:l,...t,status:s[l].status,foil:o[l].foil,rotation:s[l].rotation,maskImage:s[l].maskImage,handleCardClick:()=>d(l,r.action)},o[l].scryfallId)}))});function g(t){const l=o[t].cents;i(s.map(p=>p.id===t?{id:t,status:"FLIPPED",rotation:0,maskImage:-1}:p)),e({type:I.FLIP_CARD,payload:{amountSaved:l}}),x()}function h(t){const l=o[t].cents,p=s[t].rotation,v=s[t].maskImage;i(s.map(k=>k.id===t?{id:t,status:"RIPPED",rotation:p,maskImage:v}:k)),e({type:I.RIP_CARD,payload:{amountLost:l}}),x()}function x(){z(s)&&(console.log("All cards have been flipped or ripped"),f(),m(),L(s,A(),c))}function f(){e({type:I.PACK_STATE,payload:{action:"END"}})}function m(){e({type:I.PACK_COMPLETED,payload:{}})}}function F(e){const r=[];for(let n=0;n<e;n++)r.push({id:n,status:"NONE",rotation:U(),maskImage:_()});return r}function U(){return Math.floor(Math.random()*7)-3}function _(){return Math.floor(Math.random()*5)}function z(e){return e.filter(r=>r.status=="NONE").length==1}function K(){const e=C();return console.log("IN THE OPEN ROUTE ERROR"),E(e)?a.jsxs("div",{children:[a.jsxs("h1",{children:[e.status," ",e.statusText]}),a.jsx("p",{children:e.data})]}):e instanceof Error?a.jsxs("div",{children:[a.jsx("h1",{children:"Error"}),a.jsx("p",{children:e.message}),a.jsx("p",{children:"The stack trace is:"}),a.jsx("pre",{children:e.stack})]}):a.jsx("h1",{children:"Unknown Error"})}function $(){return a.jsx("div",{className:"",id:"index-page",children:a.jsx(T,{})})}export{K as ErrorBoundary,$ as default};
