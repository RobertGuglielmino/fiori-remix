import{r as d,j as t,d as y,i as C}from"./index-Ivv8m7sf.js";import{c as R}from"./centsToDollars-BemH1-NO.js";import{u as E,a as N,R as k}from"./FIORIContext-B_fc8As3.js";import{u as P}from"./components-YI_IdiTz.js";function w({alt:e,handleCardClick:o}){const l="https://d3vjinhen5j20w.cloudfront.net/mtg_back.webp",[s,c]=d.useState({}),r=d.useRef(null),i=d.useRef(null),m=d.useRef(!1),f=15,h=d.useCallback(p=>{!m.current||!r.current||(i.current&&cancelAnimationFrame(i.current),i.current=requestAnimationFrame(()=>{if(r.current){const a=r.current.getBoundingClientRect(),n=p.clientX-a.left,u=p.clientY-a.top,j=a.width/2,v=a.height/2,I=(u-v)/v*-15,b=(n-j)/j*f;c({transform:`perspective(1000px) rotateX(${I}deg) rotateY(${b}deg) translateZ(20px) scale(1.02)`,boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"})}}))},[]),x=d.useCallback(()=>{m.current=!0,c({transform:"translateZ(20px) scale(1.02)",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.2)"})},[]),g=d.useCallback(()=>{m.current=!1,i.current&&(cancelAnimationFrame(i.current),i.current=null),c({transform:"",boxShadow:""})},[]);return t.jsx("div",{className:"relative w-full h-full relative",children:t.jsx("div",{ref:r,className:"w-full h-full rounded-lg shadow-xl overflow-hidden transition-all duration-200 ease-out",style:{...s,transformStyle:"preserve-3d",willChange:"transform"},onMouseEnter:x,onMouseMove:h,onMouseLeave:g,children:t.jsx("img",{src:l,alt:e||"Interactive image",className:"w-full h-full object-cover ",loading:"lazy",onClick:()=>o()})})})}function S({maskImage:e,maskPosition:o,src:l}){const s=["mask-image-[url(https://d3vjinhen5j20w.cloudfront.net/mask1.webp)]","mask-image-[url(https://d3vjinhen5j20w.cloudfront.net/mask2.webp)]","mask-image-[url(https://d3vjinhen5j20w.cloudfront.net/mask3.webp)]","mask-image-[url(https://d3vjinhen5j20w.cloudfront.net/mask4.webp)]","mask-image-[url(https://d3vjinhen5j20w.cloudfront.net/mask5.webp)]"];return t.jsx("div",{className:"relative w-full h-full",children:t.jsx("img",{src:l,loading:"lazy",className:`w-full h-full object-cover relative overflow-hidden rounded-xl transition-all duration-500 scale-90 grayscale rotate-[3deg] rayscale ${s[e]} scale-[90%] mask-position-[50%_50%] mask-size-cover`})})}function M({src:e,alt:o,foil:l}){return t.jsxs("div",{className:"relative w-full h-full relative",children:[t.jsx("img",{src:e,alt:o||"Interactive image",className:"w-full h-full object-cover rounded-xl",loading:"lazy"}),l&&t.jsx("div",{className:"absolute inset-0 bg-foil-ray bg-400 animate-foil pointer-events-none rounded-lg"})]})}function D({name:e,cents:o,image:l,cf_image:s,status:c,foil:r,rotation:i,maskImage:m,handleCardClick:f}){const[h,x]=d.useState("25%_25%"),g="https://d3vjinhen5j20w.cloudfront.net/mtg_back.webp";d.useEffect(()=>{const n=new Image;n.src=s;const u=new Image;u.src=g},[s]);let p=c==="FLIPPED"||c==="RIPPED";const a="Â ";return t.jsxs("div",{className:"flex flex-col items-center rounded-lg",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:`absolute top-0 left-0 w-full h-full transition-opacity duration-200 ${c==="NONE"?"opacity-100 z-10":"opacity-0 z-0"}`,children:t.jsx(w,{alt:"Card Back",handleCardClick:f})}),t.jsx("div",{className:`absolute top-0 left-0 w-full h-full transition-opacity duration-200 ${c==="FLIPPED"?"opacity-100 z-10":"opacity-0 z-0"}`,children:t.jsx(M,{src:s,alt:e,foil:r})}),t.jsx("div",{className:`absolute top-0 left-0 w-full h-full transition-opacity duration-100 ${c==="RIPPED"?"scale-80 opacity-100 z-10":"opacity-0 z-0"}`,children:t.jsx(S,{src:s,maskImage:m,maskPosition:h})}),t.jsx("div",{className:"invisible",children:t.jsx(w,{alt:"placeholder",handleCardClick:()=>{}})})]}),t.jsx("div",{className:"font-kanit text-center text-sm",children:p?e:a}),t.jsx("div",{className:"font-kanit text-center text-sm",children:p?R(o):a})]})}function A(){let e=localStorage.getItem("flipOrRipUserId");return e?console.log("Retrieved existing user ID:",e):(e=crypto.randomUUID(),localStorage.setItem("flipOrRipUserId",e),console.log("Created new user ID:",e)),e}async function O(e,o,l){await fetch("https://s8ib0k5c81.execute-api.us-east-1.amazonaws.com/prod/flip-or-rip-lambda/stats",{method:"POST",body:JSON.stringify({cardStatusList:e,userId:o,packId:l}),headers:{"Content-Type":"application/json"}}).then(async s=>{const c=await s.json();return console.log("Loader data received:",c),c})}function T(){const e=E(),o=N(),l=P().body,s=l.cards,c=l.packId,[r,i]=d.useState(z(s.length)),m=(a,n)=>{switch(n){case"FLIP":f(a);break;case"RIP":h(a);break}};return t.jsx("div",{className:"flex flex-wrap justify-center sm:px-4 sm:px-8 lg:px-4 2xl:px-0 py-4",children:s.map((a,n)=>t.jsx("div",{className:"grow-0 shrink basis-[30vw] sm:basis-[20vw]  lg:basis-[14vw] xl:basis-[12vw] p-2",children:t.jsx(D,{index:n,...a,status:r[n].status,foil:s[n].foil,rotation:r[n].rotation,maskImage:r[n].maskImage,handleCardClick:()=>m(n,o.action)},s[n].scryfallId)}))});function f(a){const n=s[a].cents;i(r.map(u=>u.id===a?{id:a,status:"FLIPPED",rotation:0,maskImage:-1}:u)),e({type:k.FLIP_CARD,payload:{amountSaved:n}}),x()}function h(a){const n=s[a].cents,u=r[a].rotation,j=r[a].maskImage;i(r.map(v=>v.id===a?{id:a,status:"RIPPED",rotation:u,maskImage:j}:v)),e({type:k.RIP_CARD,payload:{amountLost:n}}),x()}function x(){_(r)&&(console.log("All cards have been flipped or ripped"),g(),p(),O(r,A(),c))}function g(){e({type:k.PACK_STATE,payload:{action:"END"}})}function p(){e({type:k.PACK_COMPLETED,payload:{}})}}function z(e){const o=[];for(let l=0;l<e;l++)o.push({id:l,status:"NONE",rotation:L(),maskImage:F()});return o}function L(){return Math.floor(Math.random()*7)-3}function F(){return Math.floor(Math.random()*5)}function _(e){return e.filter(o=>o.status=="NONE").length==1}function X(){const e=y();return console.log("IN THE OPEN ROUTE ERROR"),C(e)?t.jsxs("div",{children:[t.jsxs("h1",{children:[e.status," ",e.statusText]}),t.jsx("p",{children:e.data})]}):e instanceof Error?t.jsxs("div",{children:[t.jsx("h1",{children:"Error"}),t.jsx("p",{children:e.message}),t.jsx("p",{children:"The stack trace is:"}),t.jsx("pre",{children:e.stack})]}):t.jsx("h1",{children:"Unknown Error"})}function Y(){return t.jsx("div",{className:"",id:"index-page",children:t.jsx(T,{})})}export{X as ErrorBoundary,Y as default};
